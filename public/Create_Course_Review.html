<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"> 
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
body {
    margin: 0;
      padding: 0;
      font-family: sans-serif;
      background-color: #ffffff;
      height: 100%;
      padding-top: 50px;
      padding-left: 500px;
}
        /* LEFT NAVIGATION BAR */
        .left-nav {
      position: fixed;
      top: 0;
      left: 0;
      bottom: 0;
      width: 215px;
      background-color: #bababa;
      padding: 20px;
      box-sizing: border-box;
      z-index: 500;
      overflow-y: auto;
    }
    .left-nav img {
      width: 80%;
      height: auto;
      margin-bottom: 20px;
    }
    .left-nav ul {
      list-style: none;
      margin: 0;
      padding: 0;
    }
    .left-nav li {
      margin: 10px 0;
    }
    .left-nav a {
      text-decoration: none;
      color: #000;
    }
    .left-nav ul li a {
  display: block;
  text-decoration: none;
  color: black; /* Default text color */
  transition: background 0.3s, color 0.3s; /* Smooth transition */
}

.left-nav ul li a:hover {
  background:#8E8E8E;
}

.left-nav ul li a:active {
  color: black;
  background:#8E8E8E;
}

/* If you want to highlight the active page */
.left-nav ul li a.active {
  background:#8E8E8E;
  color: black;
}
    /* TOP BAR */
.top-bar {
      position: fixed;
      top: 0;
      left: 215px;
      right: 0;
      height: 50px;
      background-color: #525252;
      color: #ffffff;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 20px;
      z-index: 1000;
    }
    .top-bar .left {
      font-size: 1.2rem;
    }
    .top-bar .right span {
      margin-right: 10px;
    }
        textarea, select {
            width: 80%;
            padding: 10px;
            font-size: 16px;
            border: 1px solid #ccc;
            border-radius: 5px;
            margin-bottom: 10px;
        }
    
        textarea {
            height: 150px;
        }
    
        /* ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏° Submit ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß */
        button#submit-review {
            padding: 10px 15px;
            background-color: #28a745; /* ‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß */
            color: white;
            border: none;
            cursor: pointer;
            font-size: 16px;
            border-radius: 5px;
            margin: 5px;
        }
        .logout-button {
    background: none;
    border: none;
    color: white;
    margin-left: 10px;
    cursor: pointer;
    padding: 10px;
}

.logout-button:hover {
    background-color: #8E8E8E;
}
    
        button#submit-review:hover {
            background-color: #218838; /* ‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡πÄ‡∏Ç‡πâ‡∏° */
        }
    
        /* ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏° Back ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡πÅ‡∏î‡∏á */
        button#back-btn {
            padding: 10px 15px;
            background-color: #dc3545; /* ‡∏™‡∏µ‡πÅ‡∏î‡∏á */
            color: white;
            border: none;
            cursor: pointer;
            font-size: 16px;
            border-radius: 5px;
            margin: 5px;
        }
    
        button#back-btn:hover {
            background-color: #c82333; /* ‡∏™‡∏µ‡πÅ‡∏î‡∏á‡πÄ‡∏Ç‡πâ‡∏° */
        }
    
        /* ‡∏™‡∏•‡∏±‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏Ç‡∏≠‡∏á‡∏õ‡∏∏‡πà‡∏° */
        .button-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }
    </style>
    </head>
    <body>
          <!-- Left navigation menu -->
  <div class="left-nav">
    <img src="favicon.ico" alt="Logo" />
    <ul>
      <li><a href="announcement.html">‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ó‡∏≤‡∏á‡∏†‡∏≤‡∏Ñ‡∏ß‡∏¥‡∏ä‡∏≤</a></li>
      <li><a href="Course_Review.html">‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏†‡∏≤‡∏Ñ‡∏ß‡∏¥‡∏ä‡∏≤</a></li>
      <li><a href="addSecMain.html">‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ã‡πá‡∏Ñ‡πÄ‡∏û‡∏¥‡πà‡∏°</a></li>
      <li><a href="profMain.html">‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå</a></li>
      <li><a href="/roomBooking/studyRoom">‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏¢‡πâ‡∏≤‡∏¢‡∏´‡πâ‡∏≠‡∏á</a></li>
    </ul>
  </div>
              <!-- Top bar -->
  <div class="top-bar">
    <div class="left" id="roleTitle"></div>
    <div class="right">
      <span id="userName"></span>
      <button id="logout-button" class="logout-button">
        <i class="fa-solid fa-power-off power-icon"></i>
   </button>
    </div>
  </div>
        <!-- Course Details -->
        <h2 id="course-title">Loading...</h2>
        <p id="course-description">Fetching course details...</p>
    
        <h1>‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏≤‡∏Å‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡πÄ‡∏•‡∏¢</h1>
    
        <!-- Textbox for Writing a Review -->
        <textarea id="review-text" placeholder="Write your review here..."></textarea>
    
        <!-- Dropdown for Selecting Score (1-10) -->
        <h3>‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</h3>
        <select id="review-score">
            <option value="">Select Score</option>
            <option value="1">1 - Very Bad</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 - Average</option>
            <option value="6">6</option>
            <option value="7">7</option>
            <option value="8">8</option>
            <option value="9">9</option>
            <option value="10">10 - Excellent</option>
        </select>
    
        <!-- Button Container for Submit and Back -->
        <div class="button-container">
            <!-- Submit Button -->
            <button id="submit-review">Submit Review</button>
    
            <!-- Back Button -->
            <button id="back-btn">Back to Review</button>

    <script>
        // ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤ Course ID & User ID ‡∏à‡∏≤‡∏Å URL
        const urlParams = new URLSearchParams(window.location.search);
        const courseID = urlParams.get('CID');
        let currentUser = {};
        let announcements = [];


// Retrieve the logged-in user from the dashboard route
fetch("/dashboard")
 .then(res => res.json())
 .then(data => {
   if (data.success) {
     currentUser = data.user;
     document.getElementById("userName").textContent =
       currentUser.USER_Name + " " + currentUser.USER_Surname;
     if (currentUser.USER_Role.toLowerCase() === "student") {
       document.getElementById("roleTitle").textContent = "Nisit Comsci - ‡∏†‡∏≤‡∏Ñ‡∏ß‡∏¥‡∏ä‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå";
     } else if (["teacher", "professor"].includes(currentUser.USER_Role.toLowerCase())) {
       document.getElementById("roleTitle").textContent = "Professor Comsci - ‡∏†‡∏≤‡∏Ñ‡∏ß‡∏¥‡∏ä‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå";
     } else if (currentUser.USER_Role.toLowerCase() === "admin") {
       document.getElementById("roleTitle").textContent = "Admin - ‡∏†‡∏≤‡∏Ñ‡∏ß‡∏¥‡∏ä‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå";
     }
     if (["teacher", "professor", "admin"].includes(currentUser.USER_Role.toLowerCase())) {
       document.getElementById("postBtn").style.display = "inline-block";
     }
   } else {
     console.error("User not authenticated");
     window.location.href = "index.html"; 
   }
 })
 .catch(err => console.error(err));




        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡πà‡∏≤ courseID ‡πÅ‡∏•‡∏∞ userID
        if (!courseID || !currentUser) {
            alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Course ‡∏´‡∏£‡∏∑‡∏≠ User!");
            window.location.href = "index.html"; // ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å
        }

        // Elements
        const courseTitleElement = document.getElementById('course-title');
        const courseDescriptionElement = document.getElementById('course-description');

        let courseName = ""; // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏≠‡∏£‡πå‡∏™

        // ‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏≠‡∏£‡πå‡∏™
        const fetchCourseDetails = async () => {
            try {
                const response = await axios.get(`http://localhost:3000/api/course/${courseID}`);
                const course = response.data;
                courseTitleElement.textContent = `${course.Course_ID} - ${course.Course_Name}`;
                courseDescriptionElement.textContent = course.Course_Detail;
                courseName = course.Course_Name; // ‡πÄ‡∏Å‡πá‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡πÑ‡∏ß‡πâ‡πÉ‡∏ä‡πâ‡∏ï‡∏≠‡∏ô Submit Review
            } catch (error) {
                console.error('Error fetching course:', error);
                courseTitleElement.textContent = "Course not found!";
                courseDescriptionElement.textContent = "Could not retrieve course details.";
            }
        };

        // ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏£‡∏µ‡∏ß‡∏¥‡∏ß
        document.getElementById('back-btn').addEventListener('click', () => {
            window.location.href = `Course_Review_Details.html?CID=${courseID}`;
        });

        // ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° Submit Review
        document.getElementById('submit-review').addEventListener('click', async () => {
            const reviewText = document.getElementById('review-text').value.trim();
            const reviewScore = document.getElementById('review-score').value;

            if (!reviewText) {
                alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏Å‡πà‡∏≠‡∏ô‡πÇ‡∏û‡∏™‡∏ï‡πå");
                return;
            }

            if (!reviewScore) {
                alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡πÇ‡∏û‡∏™‡∏ï‡πå");
                return;
            }

            // üõë ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏£‡∏µ‡∏ß‡∏¥‡∏ß
            const confirmPost = confirm("‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏Å‡∏•‡∏á‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?");
            if (!confirmPost) {
                return; // ‡∏ñ‡πâ‡∏≤‡∏Å‡∏î "‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å" ‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
            }

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á Review_Course_ID ‡πÅ‡∏ö‡∏ö‡∏™‡∏∏‡πà‡∏°
            const reviewID = `R${Date.now()}`; 

            // ‡∏î‡∏∂‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
            const now = new Date();
            const reviewDate = now.toISOString().split("T")[0]; // YYYY-MM-DD
            const reviewTime = now.toTimeString().split(" ")[0]; // HH:MM:SS

            try {
                // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏¢‡∏±‡∏á Database
                await axios.post('http://localhost:3000/api/course_review', {
                    Review_Course_ID: reviewID,
                    USER_ID: currentUser.USER_ID,
                    Course_ID: courseID,
                    Review_Course_Details: reviewText,
                    Review_Course_Rate: reviewScore,
                    Review_Course_Date: reviewDate,
                    Review_Course_Time: reviewTime,
                    Course_Name: courseName
                });

                alert("‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏ñ‡∏π‡∏Å‡πÇ‡∏û‡∏™‡∏ï‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!");
                window.location.href = `Course_Review_Details.html?CID=${courseID}`; // ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ñ‡∏≠‡∏£‡πå‡∏™

            } catch (error) {
                console.error('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏£‡∏µ‡∏ß‡∏¥‡∏ß:', error);
                alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏£‡∏µ‡∏ß‡∏¥‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á!");
            }
        });

        // ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ñ‡∏≠‡∏£‡πå‡∏™
        fetchCourseDetails();
    </script>
    <link rel="stylesheet" href="/styles/dialog-styles.css">
    <!-- Dialog Container (Hidden by default) -->
    <div id="dialogContainer" class="dialog-container" style="display: none;">
      <div class="dialog-backdrop"></div>
      <div class="dialog-box">
        <div class="dialog-content">
          <p id="dialogMessage"></p>
        </div>
        <div class="dialog-actions" id="dialogActions">
          <!-- Buttons will be dynamically inserted here -->
        </div>
      </div>
    </div>
    <script src="script/dialog-script.js"></script>
    
    <script>
      const logoutButton = document.getElementById('logout-button');
      logoutButton.addEventListener('click', () => {
        if (typeof DialogManager === "undefined") {
            console.error("DialogManager is not defined. Check if dialog-script.js is loaded.");
            return;
          }
    
          const dialogManager = new DialogManager();
    
          dialogManager.showConfirmDialog('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?', () => {
              fetch("/logout", {
              method: "POST",
              headers: { "Content-Type": "application/json" }
              })
              .then(res => res.json())
              .then(data => {
                  if (data.success) {
                  currentUser = {};
                  announcements = [];
                  window.location.href = "/index.html"; // redirect to login page
                  } else {
                  console.error("Logout failed.");
                  }
              })
              .catch(err => console.error("Error during logout:", err));
              }, null);
    
          });
    </script>
</body>
</html>
