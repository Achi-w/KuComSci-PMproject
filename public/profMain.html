<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>profMain</title>
    <link rel="stylesheet" href="styles/profMain.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
</head>
<body>
    <!-- Left navigation menu -->
    <div class="left-nav">
        <img src="favicon.ico" alt="Logo" />
        <ul>
            <li><a href="announcement.html">‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ó‡∏≤‡∏á‡∏†‡∏≤‡∏Ñ‡∏ß‡∏¥‡∏ä‡∏≤</a></li>
            <li><a href="Course_Review.html">‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏†‡∏≤‡∏Ñ‡∏ß‡∏¥‡∏ä‡∏≤</a></li>
            <li><a href="addSecMain.html">‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ã‡πá‡∏Ñ‡πÄ‡∏û‡∏¥‡πà‡∏°</a></li>
            <li><a href="profMain.html" class="active">‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå</a></li>
            <li><a href="/roomBooking/studyRoom">‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏¢‡πâ‡∏≤‡∏¢‡∏´‡πâ‡∏≠‡∏á</a></li>
        </ul>
    </div>
    <!-- Top bar -->
    <div class="top-bar">
        <div class="left" id="roleTitle"></div>
        <div class="right">
            <span id="userName"></span>
            <button id="logout-button" class="logout-button">
                <i class="fa-solid fa-power-off"></i>
            </button>
        </div>
        
    </div>

    <div class="content">
        <!-- üîé Search Box -->
        <div class="search-container">
            <input class="search" name="fsrch" id="fsrch" placeholder="Search">
        </div>

        <!-- Container ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå -->
        <div id="professor-list"></div> 
    </div>

    <script>
        async function fetchProfessors() {
            try {
                const response = await fetch('http://localhost:3000/getProfessors');
                const data = await response.json();
                
                const userResponse = await fetch('http://localhost:3000/api/reauth');
                const userData = await userResponse.json();
                const user = userData.info;

                const professorList = document.getElementById('professor-list');
                professorList.innerHTML = '';

                data.forEach(prof => {
                    const isAdmin = user.USER_Role === "Admin";  // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô Admin
                    const isOwner = user.USER_Role === "Teacher" && user.USER_ID === prof.USER_ID; // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô Teacher ‡πÅ‡∏•‡∏∞ USER_ID ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô

                    const professorCard = document.createElement('div');
                    professorCard.classList.add('card');

                    professorCard.innerHTML = `
                        <p class="detail">${prof.USER_Name} ${prof.USER_Surname}</p>
                        <div class="row">
                            <img src="${prof.USER_Image || 'http://localhost:3000/uploads/default-image.jpg'}" alt="${prof.USER_Name}" />
                            <div class="column">
                                <p class="detail">‡∏£‡∏´‡∏±‡∏™‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå: ${prof.USER_ID}</p>
                                <p class="detail">‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô: ${prof.USER_Room}</p>
                                <p class="detail">${prof.USER_Contact_DETAIL}</p>
                            </div>
                            <div class="column">
                                ${isAdmin || isOwner ? `<a href="editProf.html?USER_ID=${prof.USER_ID}" class="edit">Edit</a>` : ''}
                            </div>
                        </div>
                    `;
                    professorList.appendChild(professorCard);
                });
            } catch (error) {
                console.error('Error fetching professors:', error);
            }
        }
        document.addEventListener("DOMContentLoaded", () => {
            fetch("/dashboard")
                .then(res => res.json())
                .then(data => {
                if (data.success) {
                    currentUser = data.user;
                    document.getElementById("userName").textContent =
                    currentUser.USER_Name + " " + currentUser.USER_Surname;
                    if (currentUser.USER_Role.toLowerCase() === "student") {
                    document.getElementById("roleTitle").textContent =
                        "Nisit Comsci - ‡∏†‡∏≤‡∏Ñ‡∏ß‡∏¥‡∏ä‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå";
                    } else if (["teacher", "professor"].includes(currentUser.USER_Role.toLowerCase())) {
                    document.getElementById("roleTitle").textContent =
                        "Professor Comsci - ‡∏†‡∏≤‡∏Ñ‡∏ß‡∏¥‡∏ä‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå";
                    } else if (currentUser.USER_Role.toLowerCase() === "admin") {
                    document.getElementById("roleTitle").textContent =
                        "Admin - ‡∏†‡∏≤‡∏Ñ‡∏ß‡∏¥‡∏ä‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå";
                    }
                    const postBtn = document.getElementById("postBtn");
                    if (postBtn && ["teacher", "professor", "admin"].includes(currentUser.USER_Role.toLowerCase())) {
                    postBtn.style.display = "inline-block";
                    }
                } else {
                    console.error("User not authenticated");
                    window.location.href = "index.html";
                }
                })
                .catch(err => console.error(err));
            });

        window.onload = fetchProfessors;
    </script>
</body>
</html>
